<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event | COLLECTIVE.</title>
  <meta name="description" content="Join us at this COLLECTIVE. event - connecting creative, digital and tech professionals across the East Midlands.">
  <meta name="robots" content="index, follow">

  <!-- Open Graph / Facebook - Updated dynamically via JavaScript -->
  <meta property="og:type" content="event">
  <meta property="og:title" content="Event | COLLECTIVE.">
  <meta property="og:description" content="Join us at this COLLECTIVE. event - connecting creative, digital and tech professionals across the East Midlands.">
  <meta property="og:image" content="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png">
  <meta property="og:site_name" content="COLLECTIVE.">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Event | COLLECTIVE.">
  <meta name="twitter:description" content="Join us at this COLLECTIVE. event in the East Midlands.">
  <meta name="twitter:image" content="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png">

  <!-- JSON-LD Structured Data - Injected dynamically -->
  <script id="event-jsonld" type="application/ld+json"></script>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/main.css">
  <style>
    /* Event Page Specific Styles */
    .event-hero {
      position: relative;
      min-height: 60vh;
      display: flex;
      align-items: flex-end;
      padding: var(--space-6) var(--space-4);
      overflow: hidden;
    }

    .event-hero-bg {
      position: absolute;
      inset: 0;
      z-index: 0;
    }

    .event-hero-bg img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .event-hero-bg::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, var(--black) 0%, transparent 60%);
    }

    .event-hero-content {
      position: relative;
      z-index: 1;
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
    }

    .event-meta {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-3);
      margin-bottom: var(--space-4);
    }

    .event-meta-item {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-size: var(--text-sm);
      color: var(--text-muted);
    }

    .event-meta-item svg {
      width: 18px;
      height: 18px;
      opacity: 0.7;
    }

    .event-title {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: var(--space-4);
    }

    .event-content {
      padding: var(--space-6) var(--space-4);
    }

    .event-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-6);
      max-width: 1200px;
      margin: 0 auto;
    }

    @media (min-width: 768px) {
      .event-grid {
        grid-template-columns: 2fr 1fr;
      }
    }

    .event-description {
      font-size: var(--text-lg);
      line-height: 1.8;
      color: var(--text-muted);
    }

    .event-description p {
      margin-bottom: var(--space-4);
    }

    .event-sidebar {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }

    .event-info-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
    }

    .event-info-card h3 {
      font-size: var(--text-sm);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: var(--space-4);
    }

    .info-row {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
      padding: var(--space-3) 0;
      border-bottom: 1px solid var(--border);
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-row svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      margin-top: 2px;
      color: var(--lime);
    }

    .info-row-content {
      flex: 1;
    }

    .info-row-label {
      font-size: var(--text-xs);
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .info-row-value {
      font-weight: 500;
    }

    .event-cta {
      margin-top: var(--space-4);
    }

    .event-cta .btn {
      width: 100%;
      justify-content: center;
    }

    /* Speaker Spotlight Section - Full width between hero and content */
    .speaker-spotlight {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: var(--space-6) var(--space-4);
    }

    .speaker-spotlight-inner {
      max-width: 900px;
      margin: 0 auto;
    }

    .speaker-spotlight-label {
      font-size: var(--text-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--lime);
      margin-bottom: var(--space-4);
    }

    .speaker-spotlight-card {
      display: flex;
      align-items: center;
      gap: var(--space-5);
    }

    .speaker-spotlight-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--surface-elevated);
      flex-shrink: 0;
      border: 2px solid var(--border);
    }

    .speaker-spotlight-info {
      flex: 1;
      min-width: 0;
    }

    .speaker-spotlight-info h3 {
      font-size: var(--text-xl);
      font-weight: 600;
      margin-bottom: 4px;
    }

    .speaker-spotlight-info .speaker-title {
      font-size: var(--text-base);
      color: var(--text-muted);
      margin-bottom: var(--space-2);
    }

    .speaker-spotlight-links {
      display: flex;
      gap: var(--space-4);
      align-items: center;
      flex-wrap: wrap;
    }

    .speaker-spotlight-link {
      font-size: var(--text-sm);
      color: var(--text-muted);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: color var(--transition-base);
    }

    .speaker-spotlight-link:hover {
      color: var(--lime);
    }

    .speaker-spotlight-link svg {
      width: 16px;
      height: 16px;
    }

    /* Expandable bio */
    .speaker-bio-toggle {
      background: none;
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: var(--space-2) var(--space-4);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--space-2);
      transition: all var(--transition-base);
    }

    .speaker-bio-toggle:hover {
      border-color: var(--lime);
      color: var(--lime);
    }

    .speaker-bio-toggle svg {
      width: 16px;
      height: 16px;
      transition: transform var(--transition-base);
    }

    .speaker-bio-toggle.expanded svg {
      transform: rotate(180deg);
    }

    .speaker-bio-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .speaker-bio-content.expanded {
      max-height: 1000px;
    }

    .speaker-bio-inner {
      padding-top: var(--space-5);
      margin-top: var(--space-5);
      border-top: 1px solid var(--border);
    }

    .speaker-bio-inner p {
      font-size: var(--text-base);
      line-height: 1.7;
      color: var(--text-secondary);
      margin-bottom: var(--space-4);
    }

    .speaker-bio-inner p:last-child {
      margin-bottom: 0;
    }

    @media (max-width: 600px) {
      .speaker-spotlight-card {
        flex-direction: column;
        text-align: center;
      }

      .speaker-spotlight-links {
        justify-content: center;
      }
    }

    /* Multiple speakers grid (fallback) */
    .speakers-section {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: var(--space-6) var(--space-4);
    }

    .speakers-section-inner {
      max-width: 900px;
      margin: 0 auto;
    }

    .speakers-section-label {
      font-size: var(--text-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--lime);
      margin-bottom: var(--space-4);
    }

    .speakers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--space-4);
    }

    .speaker-card {
      display: flex;
      align-items: center;
      gap: var(--space-4);
      padding: var(--space-4);
      background: var(--black);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      text-decoration: none;
      color: inherit;
      transition: all var(--transition-base);
    }

    .speaker-card:hover {
      border-color: var(--lime);
    }

    .speaker-card-link {
      cursor: pointer;
    }

    .speaker-avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--surface-elevated);
      flex-shrink: 0;
    }

    .speaker-info h3 {
      font-size: var(--text-base);
      font-weight: 600;
      margin-bottom: 2px;
    }

    .speaker-info p {
      font-size: var(--text-sm);
      color: var(--text-muted);
    }

    /* Loading State */
    .event-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      gap: var(--space-4);
    }

    .event-loading .spinner {
      width: 48px;
      height: 48px;
      border: 3px solid var(--border);
      border-top-color: var(--lime);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Error State */
    .event-error {
      text-align: center;
      padding: var(--space-8);
    }

    .event-error h1 {
      font-size: var(--text-4xl);
      margin-bottom: var(--space-4);
    }

    .event-error p {
      color: var(--text-muted);
      margin-bottom: var(--space-6);
    }

    /* Related Events */
    .related-events {
      padding: var(--space-8) var(--space-4);
      background: var(--surface);
      margin-top: var(--space-6);
    }

    .related-events h2 {
      text-align: center;
      font-size: var(--text-2xl);
      margin-bottom: var(--space-6);
    }

    .related-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--space-5);
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Card styles for related events */
    .related-grid .card {
      display: flex;
      flex-direction: column;
      text-decoration: none;
      color: inherit;
      height: 100%;
    }

    .related-grid .card-image {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      overflow: hidden;
    }

    .related-grid .card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform var(--transition-base);
    }

    .related-grid .card:hover .card-image img {
      transform: scale(1.05);
    }

    .related-grid .card-content {
      padding: var(--space-4);
      flex: 1;
    }

    .related-grid .card-meta {
      font-size: var(--text-sm);
      color: var(--text-muted);
      margin-bottom: var(--space-2);
    }

    .related-grid .card-title {
      font-size: var(--text-lg);
      font-weight: 600;
      line-height: 1.3;
    }

    .card-hover {
      transition: transform var(--transition-base), border-color var(--transition-base);
    }

    .card-hover:hover {
      transform: translateY(-4px);
      border-color: var(--lime);
    }

    /* Badge color variants */
    .badge-lime {
      background: var(--lime);
      color: var(--black);
    }

    .badge-lilac {
      background: var(--lilac);
      color: var(--black);
    }

    .badge-grey {
      background: var(--grey);
      color: var(--black);
    }

    /* Booking Modal */
    .booking-modal {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      align-items: center;
      justify-content: center;
      padding: var(--space-4);
    }

    .booking-modal.active {
      display: flex;
    }

    .booking-modal-content {
      background: var(--black);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .booking-modal-header {
      padding: var(--space-5);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      position: sticky;
      top: 0;
      background: var(--black);
      z-index: 1;
    }

    .booking-modal-header h2 {
      font-size: var(--text-xl);
      font-weight: 600;
      margin: 0;
    }

    .booking-modal-header p {
      font-size: var(--text-sm);
      color: var(--text-muted);
      margin-top: var(--space-1);
    }

    .booking-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: var(--space-2);
      margin: calc(var(--space-2) * -1);
      transition: color var(--transition-base);
    }

    .booking-close:hover {
      color: var(--white);
    }

    .booking-form {
      padding: var(--space-5);
    }

    .form-group {
      margin-bottom: var(--space-4);
    }

    .form-label {
      display: block;
      font-size: var(--text-sm);
      font-weight: 500;
      margin-bottom: var(--space-2);
      color: var(--text-primary);
    }

    .form-label .required {
      color: var(--lime);
    }

    .form-input {
      width: 100%;
      padding: var(--space-3) var(--space-4);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-family: inherit;
      font-size: var(--text-base);
      transition: border-color var(--transition-base), box-shadow var(--transition-base);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--lime);
      box-shadow: 0 0 0 3px var(--lime-10);
    }

    .form-input::placeholder {
      color: var(--text-muted);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-4);
    }

    @media (max-width: 500px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    .form-checkbox-group {
      margin-top: var(--space-5);
      padding-top: var(--space-4);
      border-top: 1px solid var(--border);
    }

    .form-checkbox-label {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
      cursor: pointer;
      font-size: var(--text-sm);
    }

    .form-checkbox {
      width: 20px;
      height: 20px;
      margin-top: 2px;
      accent-color: var(--lime);
      cursor: pointer;
      flex-shrink: 0;
    }

    .form-checkbox-text {
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .form-checkbox-text strong {
      color: var(--text-primary);
      display: block;
      margin-bottom: var(--space-1);
    }

    .form-submit {
      width: 100%;
      margin-top: var(--space-5);
    }

    .form-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .form-error {
      color: #ff6b6b;
      font-size: var(--text-sm);
      margin-top: var(--space-2);
      display: none;
    }

    .form-error.visible {
      display: block;
    }

    /* Success State */
    .booking-success {
      display: none;
      text-align: center;
      padding: var(--space-6);
    }

    .booking-success.active {
      display: block;
    }

    .booking-success svg {
      width: 64px;
      height: 64px;
      color: var(--lime);
      margin-bottom: var(--space-4);
    }

    .booking-success h2 {
      font-size: var(--text-2xl);
      margin-bottom: var(--space-3);
    }

    .booking-success p {
      color: var(--text-muted);
      margin-bottom: var(--space-5);
    }

    /* Loading spinner for form */
    .btn-spinner {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2px solid currentColor;
      border-right-color: transparent;
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
      margin-right: var(--space-2);
    }

    /* Reservation Timer */
    .reservation-timer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-4);
      background: rgba(229, 246, 8, 0.1);
      border: 1px solid var(--lime);
      border-radius: var(--radius-sm);
      margin-bottom: var(--space-4);
      font-size: var(--text-sm);
    }

    .reservation-timer svg {
      width: 18px;
      height: 18px;
      color: var(--lime);
    }

    .reservation-timer .timer-text {
      color: var(--text-muted);
    }

    .reservation-timer .timer-countdown {
      font-weight: 600;
      color: var(--lime);
      font-variant-numeric: tabular-nums;
    }

    .reservation-timer.warning {
      background: rgba(255, 107, 107, 0.1);
      border-color: #ff6b6b;
    }

    .reservation-timer.warning .timer-countdown,
    .reservation-timer.warning svg {
      color: #ff6b6b;
    }

    .reservation-timer.expired {
      background: rgba(255, 107, 107, 0.15);
      border-color: #ff6b6b;
    }

    /* Booking Loading Overlay */
    .booking-loading {
      display: none;
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--space-4);
      border-radius: var(--radius-lg);
    }

    .booking-loading.active {
      display: flex;
    }

    .booking-loading .spinner {
      width: 48px;
      height: 48px;
      border: 3px solid var(--border);
      border-top-color: var(--lime);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .booking-loading p {
      color: var(--text-muted);
      text-align: center;
    }

    .booking-loading .loading-step {
      font-size: var(--text-sm);
      color: var(--lime);
      margin-top: var(--space-2);
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="nav">
    <div class="nav-container">
      <a href="/" class="nav-logo">
        <img src="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png" alt="COLLECTIVE." height="40">
      </a>
      <div class="nav-links">
        <a href="/" class="nav-link">Events</a>
        <a href="/speakers" class="nav-link">Speakers</a>
        <a href="/about" class="nav-link">About</a>
      </div>
    </div>
  </nav>

  <!-- Loading State -->
  <div id="loading" class="event-loading">
    <div class="spinner"></div>
    <p>Loading event...</p>
  </div>

  <!-- Error State (hidden by default) -->
  <div id="error" class="event-error" style="display: none;">
    <h1>Event Not Found</h1>
    <p>Sorry, we couldn't find the event you're looking for.</p>
    <a href="/" class="btn btn--primary">Back to Events</a>
  </div>

  <!-- Event Content (hidden until loaded) -->
  <main id="event-content" style="display: none;">
    <!-- Hero Section -->
    <section class="event-hero">
      <div class="event-hero-bg">
        <img id="event-image" src="" alt="">
      </div>
      <div class="event-hero-content">
        <div class="event-meta">
          <span id="event-badge" class="badge badge-lime"></span>
          <span id="event-status" class="badge"></span>
        </div>
        <h1 id="event-title" class="event-title"></h1>
      </div>
    </section>

    <!-- Speaker Spotlight (shown between hero and content if speakers exist) -->
    <section id="speaker-spotlight" class="speaker-spotlight" style="display: none;">
      <div class="speaker-spotlight-inner" id="speaker-spotlight-content"></div>
    </section>

    <!-- Event Details -->
    <section class="event-content">
      <div class="event-grid">
        <div class="event-main">
          <div id="event-description" class="event-description"></div>
        </div>

        <aside class="event-sidebar">
          <div class="event-info-card">
            <h3>Event Details</h3>

            <div class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <div class="info-row-content">
                <div class="info-row-label">Date</div>
                <div id="event-date" class="info-row-value"></div>
              </div>
            </div>

            <div class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <div class="info-row-content">
                <div class="info-row-label">Time</div>
                <div id="event-time" class="info-row-value"></div>
              </div>
            </div>

            <div class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <div class="info-row-content">
                <div class="info-row-label">Location</div>
                <div id="event-location" class="info-row-value"></div>
              </div>
            </div>

            <div id="venue-row" class="info-row" style="display: none;">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
              <div class="info-row-content">
                <div class="info-row-label">Venue</div>
                <div id="event-venue" class="info-row-value"></div>
              </div>
            </div>

            <div id="address-row" class="info-row" style="display: none;">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
              </svg>
              <div class="info-row-content">
                <div class="info-row-label">Address</div>
                <div id="event-address" class="info-row-value"></div>
              </div>
            </div>

            <div id="price-row" class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <div class="info-row-content">
                <div class="info-row-label">Price</div>
                <div id="event-price" class="info-row-value">Free</div>
              </div>
            </div>

            <div id="cta-container" class="event-cta"></div>

            <!-- Map Links -->
            <div id="map-links" class="event-map-links" style="display: none; margin-top: var(--space-4); padding-top: var(--space-4); border-top: 1px solid var(--border);">
              <div style="display: flex; gap: var(--space-2); flex-wrap: wrap;">
                <a id="google-maps-link" href="#" target="_blank" class="btn btn-secondary" style="flex: 1; font-size: var(--text-sm);">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                  </svg>
                  Google Maps
                </a>
                <a id="what3words-link" href="#" target="_blank" class="btn btn-secondary" style="flex: 1; font-size: var(--text-sm); display: none;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 3h6v6H3V3zm12 0h6v6h-6V3zM3 15h6v6H3v-6zm12 0h6v6h-6v-6z"/>
                  </svg>
                  what3words
                </a>
              </div>
            </div>
          </div>

          <!-- Share Card -->
          <div class="event-info-card">
            <h3>Share This Event</h3>
            <div style="display: flex; gap: var(--space-3);">
              <button onclick="shareTwitter()" class="btn btn-secondary" style="flex: 1;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
              </button>
              <button onclick="shareLinkedIn()" class="btn btn-secondary" style="flex: 1;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </button>
              <button onclick="copyLink()" class="btn btn-secondary" style="flex: 1;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                </svg>
              </button>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <!-- Related Events -->
    <section id="related-events" class="related-events" style="display: none;">
      <h2>More Events</h2>
      <div id="related-grid" class="related-grid"></div>
    </section>
  </main>

  <!-- Booking Modal -->
  <div id="booking-modal" class="booking-modal" onclick="if(event.target === this) closeBookingModal()">
    <div class="booking-modal-content">
      <!-- Loading Overlay -->
      <div id="booking-loading" class="booking-loading">
        <div class="spinner"></div>
        <p>Confirming your booking...</p>
        <div id="loading-step" class="loading-step">Connecting to booking system</div>
      </div>

      <!-- Form View -->
      <div id="booking-form-view">
        <div class="booking-modal-header">
          <div>
            <h2>Book Your Place</h2>
            <p id="booking-event-title"></p>
          </div>
          <button class="booking-close" onclick="closeBookingModal()" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <form id="booking-form" class="booking-form" onsubmit="submitBooking(event)">
          <!-- Reservation Timer -->
          <div id="reservation-timer" class="reservation-timer">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12,6 12,12 16,14"/>
            </svg>
            <span class="timer-text">Your place is reserved for</span>
            <span id="timer-countdown" class="timer-countdown">5:00</span>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="firstName">First Name <span class="required">*</span></label>
              <input type="text" id="firstName" name="firstName" class="form-input" placeholder="First Name" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="lastName">Last Name <span class="required">*</span></label>
              <input type="text" id="lastName" name="lastName" class="form-input" placeholder="Last Name" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="phone">Phone</label>
            <input type="tel" id="phone" name="phone" class="form-input" placeholder="Phone">
          </div>

          <div class="form-group">
            <label class="form-label" for="businessName">Business Name <span class="required">*</span></label>
            <input type="text" id="businessName" name="businessName" class="form-input" placeholder="Business Name" required>
          </div>

          <div class="form-group">
            <label class="form-label" for="email">Email <span class="required">*</span></label>
            <input type="email" id="email" name="email" class="form-input" placeholder="Email" required>
          </div>

          <div class="form-checkbox-group">
            <label class="form-checkbox-label">
              <input type="checkbox" id="optIn" name="optIn" class="form-checkbox">
              <span class="form-checkbox-text">
                <strong>Stay in the loop with COLLECTIVE?</strong>
                Tick to get updates and event news from COLLECTIVE by email. If you add your phone number, we'll send occasional WhatsApp updates as well. You can unsubscribe from either at any time.
              </span>
            </label>
          </div>

          <div id="form-error" class="form-error"></div>

          <button type="submit" id="submit-btn" class="btn btn--primary form-submit">
            Book Now
          </button>
        </form>
      </div>

      <!-- Success View -->
      <div id="booking-success-view" class="booking-success">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
          <polyline points="22,4 12,14.01 9,11.01"/>
        </svg>
        <h2>You're booked!</h2>
        <p id="success-message">Check your email for confirmation and event details.</p>
        <button onclick="closeBookingModal()" class="btn btn--primary">Done</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-brand">
        <img src="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png" alt="COLLECTIVE." class="footer-logo" height="32">
        <p>Building connections across the East Midlands creative, digital and tech community.</p>
      </div>
      <div class="footer-links">
        <h4>Events</h4>
        <ul>
          <li><a href="/">Upcoming</a></li>
          <li><a href="/past">Past Events</a></li>
          <li><a href="/speakers">Speakers</a></li>
        </ul>
      </div>
      <div class="footer-links">
        <h4>Locations</h4>
        <ul>
          <li><a href="/nottingham">Nottingham</a></li>
          <li><a href="/mansfield">Mansfield</a></li>
          <li><a href="/chesterfield">Chesterfield</a></li>
          <li><a href="/derby">Derby</a></li>
        </ul>
      </div>
      <div class="footer-links">
        <h4>Connect</h4>
        <ul>
          <li><a href="/about">About Us</a></li>
          <li><a href="/privacy">Privacy Policy</a></li>
          <li><a href="/terms">Terms & Conditions</a></li>
          <li><a href="mailto:hello@cdicollective.co.uk">Contact</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <div style="display: flex; flex-direction: column; gap: 0.5rem; align-items: flex-start;">
        <span style="color: var(--text-secondary); font-size: 0.9rem;">Proudly built in Notts by <a href="https://notluck.co.uk" target="_blank" style="color: var(--lime); text-decoration: none;">NotLuck</a></span>
        <span>&copy; 2026 COLLECTIVE. All rights reserved.</span>
      </div>
      <div class="social-links">
        <a href="https://linkedin.com/company/cdicollective" target="_blank" aria-label="LinkedIn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
        </a>
        <a href="https://instagram.com/cdicollective" target="_blank" aria-label="Instagram">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
        </a>
      </div>
    </div>
  </footer>

  <script src="/assets/js/api.js?v=3"></script>
  <script>
    // Check API loaded correctly
    if (!window.CollectiveAPI) {
      console.error('CollectiveAPI not loaded!');
      document.getElementById('loading').innerHTML = '<p style="color: #E5F608;">Error: API library not loaded. Please refresh the page.</p>';
      throw new Error('CollectiveAPI not loaded');
    }

    const { fetchEvent, fetchEvents, getEventImage, getEventPlaceholder, hasEventImage, formatDate, formatTime, getLocationColor, isUpcoming, DEFAULT_AVATAR } = window.CollectiveAPI;

    let currentEvent = null;

    async function loadEvent() {
      const slug = window.location.pathname.replace('/event/', '').replace(/^\/|\/$/g, '');
      console.log('Loading event with slug:', slug);

      if (!slug) {
        console.error('No slug found in URL');
        showError();
        return;
      }

      try {
        const event = await fetchEvent(slug);
        console.log('Fetched event:', event);

        if (!event) {
          console.error('Event not found for slug:', slug);
          showError();
          return;
        }

        currentEvent = event;
        renderEvent(event);
        loadRelatedEvents(event);
      } catch (error) {
        console.error('Error loading event:', error);
        showError();
      }
    }

    // Generate URL-friendly slug from speaker name
    function getSpeakerSlug(name) {
      if (!name) return '';
      return name.toLowerCase().trim()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-');
    }

    function renderEvent(event) {
      // Hide loading, show content
      document.getElementById('loading').style.display = 'none';
      document.getElementById('event-content').style.display = 'block';

      // Hero image - use placeholder if no image
      const heroImg = document.getElementById('event-image');
      heroImg.src = hasEventImage(event) ? getEventImage(event) : getEventPlaceholder(event);
      heroImg.alt = event.title;

      // Badge
      const badge = document.getElementById('event-badge');
      const colorClass = getLocationColor(event.locationTag);
      badge.className = `badge badge-${colorClass}`;
      badge.textContent = event.locationTag || 'Event';

      // Status badge
      const status = document.getElementById('event-status');
      if (isUpcoming(event.date)) {
        status.className = 'badge badge-lime';
        status.textContent = 'Upcoming';
      } else {
        status.className = 'badge badge-grey';
        status.textContent = 'Past Event';
      }

      // Title
      document.getElementById('event-title').textContent = event.title;

      // Description - use fullDescription first, fall back to shortDescription
      const descEl = document.getElementById('event-description');
      const description = event.fullDescription || event.description || event.shortDescription || '';
      descEl.innerHTML = description.split('\n').filter(p => p.trim()).map(p => `<p>${p}</p>`).join('');

      // Date & Time
      document.getElementById('event-date').textContent = formatDate(event.date);

      // Build time string from startTime and endTime
      let timeStr = 'TBA';
      if (event.startTime) {
        timeStr = event.startTime;
        if (event.endTime) {
          timeStr += ' - ' + event.endTime;
        }
      }
      document.getElementById('event-time').textContent = timeStr;

      // Location
      document.getElementById('event-location').textContent = event.locationTag || 'TBA';

      // Venue
      if (event.venueName) {
        document.getElementById('venue-row').style.display = 'flex';
        document.getElementById('event-venue').textContent = event.venueName;
      }

      // Price
      document.getElementById('event-price').textContent = event.price || 'Free';

      // Address
      if (event.venue?.address || event.address) {
        document.getElementById('address-row').style.display = 'flex';
        document.getElementById('event-address').textContent = event.venue?.address || event.address;
      }

      // Map links
      const venueAddress = event.venue?.address || event.address;
      const what3words = event.venue?.what3words || event.what3words;

      if (venueAddress || what3words) {
        document.getElementById('map-links').style.display = 'block';

        if (venueAddress) {
          const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(venueAddress)}`;
          document.getElementById('google-maps-link').href = mapsUrl;
        }

        if (what3words) {
          document.getElementById('what3words-link').style.display = 'flex';
          document.getElementById('what3words-link').href = `https://what3words.com/${what3words.replace('///', '')}`;
        }
      }

      // CTA Button - Use our booking modal for direct calendar integration
      const ctaContainer = document.getElementById('cta-container');

      // Log event data for debugging
      console.log('Event data:', event);
      console.log('Is upcoming:', isUpcoming(event.date));

      if (isUpcoming(event.date)) {
        let ctaHtml = '';

        // Book Your Place button - opens our modal
        ctaHtml += `
          <button onclick="openBookingModal()" class="btn btn--primary" style="width: 100%; margin-bottom: var(--space-2); display: flex;">
            Book Your Place
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
        `;

        // Add to Calendar button
        ctaHtml += `
          <button onclick="addToCalendar()" class="btn btn--secondary" style="width: 100%; display: flex;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            Add to Calendar
          </button>
        `;

        ctaContainer.innerHTML = ctaHtml;
      }

      // Speakers - render in spotlight section between hero and content
      const speakers = event.speakers || (event.speaker?.name ? [event.speaker] : []);
      if (speakers.length > 0) {
        document.getElementById('speaker-spotlight').style.display = 'block';
        const spotlightContent = document.getElementById('speaker-spotlight-content');

        if (speakers.length === 1) {
          // Single speaker - featured spotlight with expandable bio
          const speaker = speakers[0];
          const hasProfile = !!speaker.contactId;
          const hasBio = !!speaker.bio;

          spotlightContent.innerHTML = `
            <div class="speaker-spotlight-label">Featured Speaker</div>
            <div class="speaker-spotlight-card">
              <img src="${speaker.photo || speaker.image || DEFAULT_AVATAR}" alt="${speaker.name}" class="speaker-spotlight-avatar" onerror="this.src='${DEFAULT_AVATAR}'">
              <div class="speaker-spotlight-info">
                <h3>${hasProfile ? `<a href="/speaker/${getSpeakerSlug(speaker.name)}" style="color: inherit; text-decoration: none;">${speaker.name}</a>` : speaker.name}</h3>
                ${speaker.title ? `<p class="speaker-title">${speaker.title}</p>` : ''}
                <div class="speaker-spotlight-links">
                  ${hasProfile ? `
                    <a href="/speaker/${getSpeakerSlug(speaker.name)}" class="speaker-spotlight-link">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                      View Profile
                    </a>
                  ` : ''}
                  ${speaker.socials?.linkedin ? `
                    <a href="${speaker.socials.linkedin}" target="_blank" class="speaker-spotlight-link">
                      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                      LinkedIn
                    </a>
                  ` : ''}
                  ${hasBio ? `
                    <button class="speaker-bio-toggle" onclick="toggleSpeakerBio(this)">
                      About ${speaker.name.split(' ')[0]}
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                    </button>
                  ` : ''}
                </div>
              </div>
            </div>
            ${hasBio ? `
              <div class="speaker-bio-content" id="speaker-bio">
                <div class="speaker-bio-inner">
                  ${speaker.bio.split('\n').filter(p => p.trim()).map(p => `<p>${p}</p>`).join('')}
                </div>
              </div>
            ` : ''}
          `;
        } else {
          // Multiple speakers - grid layout
          spotlightContent.innerHTML = `
            <div class="speakers-section-label">Speakers</div>
            <div class="speakers-grid">
              ${speakers.map(speaker => {
                const hasProfile = !!speaker.contactId;
                const cardContent = `
                  <img src="${speaker.photo || speaker.image || DEFAULT_AVATAR}" alt="${speaker.name}" class="speaker-avatar" onerror="this.src='${DEFAULT_AVATAR}'">
                  <div class="speaker-info">
                    <h3>${speaker.name}</h3>
                    <p>${speaker.title || ''}</p>
                  </div>
                `;
                return hasProfile
                  ? `<a href="/speaker/${getSpeakerSlug(speaker.name)}" class="speaker-card speaker-card-link">${cardContent}</a>`
                  : `<div class="speaker-card">${cardContent}</div>`;
              }).join('')}
            </div>
          `;
        }
      }

      // Update page title
      document.title = `${event.title} | COLLECTIVE.`;

      // Inject JSON-LD structured data
      injectEventJsonLd(event);
    }

    /**
     * Inject Event schema JSON-LD for SEO
     */
    function injectEventJsonLd(event) {
      const jsonLd = {
        "@context": "https://schema.org",
        "@type": "Event",
        "name": event.title,
        "description": event.shortDescription || event.fullDescription?.substring(0, 200) || '',
        "startDate": event.date,
        "endDate": event.date,
        "eventStatus": "https://schema.org/EventScheduled",
        "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
        "url": window.location.href,
        "image": event.featuredImage || "https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png",
        "organizer": {
          "@type": "Organization",
          "name": "COLLECTIVE.",
          "url": "https://collective-events.netlify.app"
        },
        "offers": {
          "@type": "Offer",
          "price": event.price === "Free" ? "0" : event.price || "0",
          "priceCurrency": "GBP",
          "availability": event.capacity?.status === "sold_out"
            ? "https://schema.org/SoldOut"
            : "https://schema.org/InStock",
          "url": window.location.href
        }
      };

      // Add location if venue exists
      if (event.venue) {
        jsonLd.location = {
          "@type": "Place",
          "name": event.venue.name || event.locationTag,
          "address": {
            "@type": "PostalAddress",
            "streetAddress": event.venue.address || '',
            "addressLocality": event.venue.city || event.locationTag || '',
            "postalCode": event.venue.postcode || '',
            "addressCountry": "GB"
          }
        };
      }

      // Add performer if speaker exists
      if (event.speaker?.name) {
        jsonLd.performer = {
          "@type": "Person",
          "name": event.speaker.name
        };
        if (event.speaker.contactId) {
          jsonLd.performer.url = `https://collective-events.netlify.app/speaker/${getSpeakerSlug(event.speaker.name)}`;
        }
      }

      // Inject into page
      const scriptEl = document.getElementById('event-jsonld');
      if (scriptEl) {
        scriptEl.textContent = JSON.stringify(jsonLd);
      }

      // Also update OG meta tags dynamically
      updateMetaTags(event);
    }

    /**
     * Update Open Graph meta tags dynamically
     */
    function updateMetaTags(event) {
      const image = event.featuredImage || "https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png";
      const description = event.shortDescription || event.fullDescription?.substring(0, 160) || '';
      const url = window.location.href;

      // Update OG tags
      document.querySelector('meta[property="og:title"]')?.setAttribute('content', event.title);
      document.querySelector('meta[property="og:description"]')?.setAttribute('content', description);
      document.querySelector('meta[property="og:image"]')?.setAttribute('content', image);
      document.querySelector('meta[property="og:url"]')?.setAttribute('content', url);

      // Update Twitter tags
      document.querySelector('meta[name="twitter:title"]')?.setAttribute('content', event.title);
      document.querySelector('meta[name="twitter:description"]')?.setAttribute('content', description);
      document.querySelector('meta[name="twitter:image"]')?.setAttribute('content', image);

      // Update page description
      document.querySelector('meta[name="description"]')?.setAttribute('content', description);
    }

    async function loadRelatedEvents(currentEvent) {
      const data = await fetchEvents({ limit: 6, upcoming: true });
      const related = data.events.filter(e => e.id !== currentEvent.id).slice(0, 3);

      if (related.length > 0) {
        document.getElementById('related-events').style.display = 'block';
        const grid = document.getElementById('related-grid');
        grid.innerHTML = related.map(event => `
          <a href="/event/${event.slug || event.id}" class="card card-hover">
            <div class="card-image">
              <img src="${getEventImage(event)}" alt="${event.title}">
              <span class="badge badge-${getLocationColor(event.locationTag)}" style="position: absolute; top: 12px; left: 12px;">
                ${event.locationTag || 'Event'}
              </span>
            </div>
            <div class="card-content">
              <div class="card-meta">${formatDate(event.date)}</div>
              <h3 class="card-title">${event.title}</h3>
            </div>
          </a>
        `).join('');
      }
    }

    function showError() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
    }

    // Toggle speaker bio expansion
    function toggleSpeakerBio(btn) {
      const bioContent = document.getElementById('speaker-bio');
      if (bioContent) {
        bioContent.classList.toggle('expanded');
        btn.classList.toggle('expanded');
      }
    }

    // Share functions
    function shareTwitter() {
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent(currentEvent?.title || 'Check out this event');
      window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
    }

    function shareLinkedIn() {
      const url = encodeURIComponent(window.location.href);
      window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
    }

    function copyLink() {
      navigator.clipboard.writeText(window.location.href).then(() => {
        alert('Link copied to clipboard!');
      });
    }

    function addToCalendar() {
      if (!currentEvent) return;

      const event = currentEvent;
      const title = encodeURIComponent(event.title);
      const location = encodeURIComponent(event.venue?.address || event.locationTag || '');
      const description = encodeURIComponent(event.shortDescription || '');

      // Parse date and time
      const eventDate = new Date(event.date);
      let startTime = event.startTime || '17:00';
      let endTime = event.endTime || '19:30';

      // Create start and end datetime strings
      const [startHour, startMin] = startTime.split(':');
      const [endHour, endMin] = endTime.split(':');

      const startDate = new Date(eventDate);
      startDate.setHours(parseInt(startHour), parseInt(startMin), 0);

      const endDate = new Date(eventDate);
      endDate.setHours(parseInt(endHour), parseInt(endMin), 0);

      // Format for Google Calendar (YYYYMMDDTHHmmss)
      const formatGoogleDate = (date) => {
        return date.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');
      };

      const googleUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${formatGoogleDate(startDate)}/${formatGoogleDate(endDate)}&details=${description}&location=${location}`;

      window.open(googleUrl, '_blank');
    }

    // ============================================
    // Booking Modal Functions
    // ============================================

    const BOOKING_API = '/.netlify/functions/book';
    const CALENDAR_ID = 'Bv8FhvFB2lOEcWreAcOM';
    const RESERVATION_TIME = 5 * 60; // 5 minutes in seconds

    let reservationTimer = null;
    let reservationSeconds = RESERVATION_TIME;

    function openBookingModal() {
      if (!currentEvent) return;

      // Set event title in modal
      document.getElementById('booking-event-title').textContent = currentEvent.title;

      // Reset form
      document.getElementById('booking-form').reset();
      document.getElementById('form-error').classList.remove('visible');
      document.getElementById('form-error').textContent = '';

      // Reset and hide loading overlay
      document.getElementById('booking-loading').classList.remove('active');

      // Show form view, hide success view
      document.getElementById('booking-form-view').style.display = 'block';
      document.getElementById('booking-success-view').classList.remove('active');

      // Reset timer
      resetReservationTimer();
      startReservationTimer();

      // Show modal
      document.getElementById('booking-modal').classList.add('active');
      document.body.style.overflow = 'hidden';

      // Focus first input
      setTimeout(() => {
        document.getElementById('firstName').focus();
      }, 100);
    }

    function closeBookingModal() {
      document.getElementById('booking-modal').classList.remove('active');
      document.body.style.overflow = '';
      stopReservationTimer();
    }

    // ============================================
    // Reservation Timer Functions
    // ============================================

    function resetReservationTimer() {
      reservationSeconds = RESERVATION_TIME;
      const timerEl = document.getElementById('reservation-timer');
      timerEl.classList.remove('warning', 'expired');
      // Restore original timer HTML in case it was showing expired state
      timerEl.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12,6 12,12 16,14"/>
        </svg>
        <span class="timer-text">Your place is reserved for</span>
        <span id="timer-countdown" class="timer-countdown">5:00</span>
      `;
      updateTimerDisplay();
    }

    function startReservationTimer() {
      stopReservationTimer();
      reservationTimer = setInterval(() => {
        reservationSeconds--;
        updateTimerDisplay();

        if (reservationSeconds <= 0) {
          handleTimerExpired();
        } else if (reservationSeconds <= 60) {
          // Warning state when under 1 minute
          document.getElementById('reservation-timer').classList.add('warning');
        }
      }, 1000);
    }

    function stopReservationTimer() {
      if (reservationTimer) {
        clearInterval(reservationTimer);
        reservationTimer = null;
      }
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(reservationSeconds / 60);
      const seconds = reservationSeconds % 60;
      const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      document.getElementById('timer-countdown').textContent = display;
    }

    function handleTimerExpired() {
      stopReservationTimer();
      const timerEl = document.getElementById('reservation-timer');
      timerEl.classList.add('expired');
      timerEl.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span class="timer-text" style="color: #ff6b6b;">Session expired</span>
        <button onclick="resetReservationTimer(); startReservationTimer();" style="background: none; border: 1px solid #ff6b6b; color: #ff6b6b; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
          Restart
        </button>
      `;
    }

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeBookingModal();
      }
    });

    async function submitBooking(e) {
      e.preventDefault();

      const submitBtn = document.getElementById('submit-btn');
      const errorDiv = document.getElementById('form-error');
      const loadingOverlay = document.getElementById('booking-loading');
      const loadingStep = document.getElementById('loading-step');

      // Get form data
      const formData = {
        firstName: document.getElementById('firstName').value.trim(),
        lastName: document.getElementById('lastName').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        businessName: document.getElementById('businessName').value.trim(),
        email: document.getElementById('email').value.trim(),
        optIn: document.getElementById('optIn').checked,
        // Event details
        eventId: currentEvent.id,
        eventTitle: currentEvent.title,
        eventDate: currentEvent.date,
        eventStartTime: currentEvent.startTime || '17:00',
        eventEndTime: currentEvent.endTime || '19:30',
        eventLocation: currentEvent.locationTag || '',
        eventVenue: currentEvent.venue?.name || currentEvent.venueName || '',
        eventVenueAddress: currentEvent.venue?.address || currentEvent.address || '',
        eventVenueWhat3Words: currentEvent.venue?.what3words || currentEvent.what3words || '',
        eventVenueAccessibility: currentEvent.venue?.accessibility || currentEvent.accessibility || '',
        eventVenueParking: currentEvent.venue?.parking || currentEvent.parking || '',
        eventVenueNotes: currentEvent.venue?.notes || '',
        calendarId: currentEvent.calendarId || CALENDAR_ID
      };

      // Validate
      if (!formData.firstName || !formData.lastName || !formData.businessName || !formData.email) {
        errorDiv.textContent = 'Please fill in all required fields.';
        errorDiv.classList.add('visible');
        return;
      }

      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(formData.email)) {
        errorDiv.textContent = 'Please enter a valid email address.';
        errorDiv.classList.add('visible');
        return;
      }

      // Stop timer and show loading overlay
      stopReservationTimer();
      submitBtn.disabled = true;
      errorDiv.classList.remove('visible');
      loadingOverlay.classList.add('active');
      loadingStep.textContent = 'Connecting to booking system...';

      // Simulate progress steps for better UX
      const progressSteps = [
        { text: 'Creating your profile...', delay: 800 },
        { text: 'Reserving your place...', delay: 1500 },
        { text: 'Confirming booking...', delay: 2500 }
      ];

      let stepIndex = 0;
      const progressInterval = setInterval(() => {
        if (stepIndex < progressSteps.length) {
          loadingStep.textContent = progressSteps[stepIndex].text;
          stepIndex++;
        }
      }, 1200);

      try {
        const response = await fetch(BOOKING_API, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        clearInterval(progressInterval);

        if (!response.ok || !result.success) {
          throw new Error(result.error || 'Booking failed. Please try again.');
        }

        // Check if booking was confirmed
        if (result.confirmed) {
          loadingStep.textContent = 'Booking confirmed!';
        } else {
          loadingStep.textContent = 'Booking submitted...';
        }

        // Brief pause to show success state
        await new Promise(resolve => setTimeout(resolve, 500));

        // Hide loading, show success view
        loadingOverlay.classList.remove('active');
        document.getElementById('booking-form-view').style.display = 'none';
        document.getElementById('booking-success-view').classList.add('active');

        // Update success message with event details
        document.getElementById('success-message').textContent =
          `You're booked for ${currentEvent.title}! Check your email for confirmation and event details.`;

      } catch (error) {
        console.error('Booking error:', error);
        clearInterval(progressInterval);
        loadingOverlay.classList.remove('active');
        errorDiv.textContent = error.message || 'Something went wrong. Please try again.';
        errorDiv.classList.add('visible');
        // Restart timer on error
        resetReservationTimer();
        startReservationTimer();
      } finally {
        // Reset button
        submitBtn.disabled = false;
      }
    }

    // Initialize
    loadEvent();
  </script>
  <!-- Cookie Consent & Analytics -->
  <script>
    // Configure your tracking IDs here
    window.GA_MEASUREMENT_ID = ""; // e.g., "G-XXXXXXXXXX"
    window.HOTJAR_ID = ""; // e.g., 1234567
  </script>
  <script src="/assets/js/cookie-consent.js"></script>
</body>
</html>
