<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Location | COLLECTIVE.</title>
  <meta name="description" content="Discover COLLECTIVE. events in your area - connecting creative, digital and tech professionals across the East Midlands.">
  <meta name="robots" content="index, follow">

  <!-- Open Graph / Facebook - Updated dynamically via JavaScript -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Location | COLLECTIVE.">
  <meta property="og:description" content="Discover COLLECTIVE. events in your area - connecting creative, digital and tech professionals across the East Midlands.">
  <meta property="og:image" content="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png">
  <meta property="og:site_name" content="COLLECTIVE.">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Location | COLLECTIVE.">
  <meta name="twitter:description" content="Discover COLLECTIVE. events in your area.">
  <meta name="twitter:image" content="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/main.css">
  <style>
    /* Location Page Specific Styles */
    .location-hero {
      position: relative;
      min-height: 50vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: var(--space-8) var(--space-4);
      overflow: hidden;
    }

    .location-hero-bg {
      position: absolute;
      inset: 0;
      z-index: 0;
    }

    .location-hero-bg img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .location-hero-bg::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.5) 100%);
    }

    .location-hero-content {
      position: relative;
      z-index: 1;
      max-width: 800px;
    }

    .location-hero h1 {
      font-size: clamp(2.5rem, 6vw, 4rem);
      font-weight: 700;
      margin-bottom: var(--space-4);
    }

    .location-hero p {
      font-size: var(--text-xl);
      color: var(--text-muted);
      max-width: 600px;
      margin: 0 auto;
    }

    .location-stats {
      display: flex;
      justify-content: center;
      gap: var(--space-6);
      margin-top: var(--space-6);
      flex-wrap: wrap;
    }

    .location-stat {
      text-align: center;
    }

    .location-stat-value {
      font-size: var(--text-3xl);
      font-weight: 700;
    }

    .location-stat-label {
      font-size: var(--text-sm);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Events Section */
    .location-events {
      padding: var(--space-8) var(--space-4);
    }

    .section-header {
      text-align: center;
      margin-bottom: var(--space-6);
    }

    .section-header h2 {
      font-size: var(--text-3xl);
      margin-bottom: var(--space-2);
    }

    .section-header p {
      color: var(--text-muted);
    }

    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: var(--space-5);
      max-width: 1200px;
      margin: 0 auto;
    }

    /* About Location Section */
    .location-about {
      padding: var(--space-8) var(--space-4);
      background: var(--surface);
    }

    .about-content {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    .about-content h2 {
      font-size: var(--text-2xl);
      margin-bottom: var(--space-4);
    }

    .about-content p {
      font-size: var(--text-lg);
      color: var(--text-muted);
      line-height: 1.8;
      margin-bottom: var(--space-4);
    }

    /* Other Locations */
    .other-locations {
      padding: var(--space-8) var(--space-4);
    }

    .locations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-5);
      max-width: 900px;
      margin: 0 auto;
    }

    .location-card {
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
      aspect-ratio: 16/9;
      text-decoration: none;
      color: inherit;
    }

    .location-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform var(--transition-base);
    }

    .location-card:hover img {
      transform: scale(1.05);
    }

    .location-card-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 60%);
      display: flex;
      align-items: flex-end;
      padding: var(--space-4);
    }

    .location-card h3 {
      font-size: var(--text-xl);
      font-weight: 600;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: var(--space-8);
      color: var(--text-muted);
    }

    .empty-state h3 {
      font-size: var(--text-xl);
      margin-bottom: var(--space-2);
      color: var(--text-primary);
    }

    /* Loading */
    .loading-spinner {
      display: flex;
      justify-content: center;
      padding: var(--space-8);
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--lime);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="nav">
    <div class="nav-container">
      <a href="/" class="nav-logo">
        <img src="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png" alt="COLLECTIVE." height="40">
      </a>
      <div class="nav-links">
        <a href="/" class="nav-link">Events</a>
        <a href="/speakers" class="nav-link">Speakers</a>
        <a href="/about" class="nav-link">About</a>
      </div>
    </div>
  </nav>

  <main>
    <!-- Hero Section -->
    <section class="location-hero">
      <div class="location-hero-bg">
        <img id="hero-image" src="" alt="">
      </div>
      <div class="location-hero-content">
        <span id="hero-badge" class="badge badge-lime">COLLECTIVE.</span>
        <h1 id="location-title"></h1>
        <p id="location-description"></p>
        <div class="location-stats">
          <div class="location-stat">
            <div id="stat-events" class="location-stat-value">-</div>
            <div class="location-stat-label">Events</div>
          </div>
          <div class="location-stat">
            <div id="stat-upcoming" class="location-stat-value">-</div>
            <div class="location-stat-label">Upcoming</div>
          </div>
          <div class="location-stat">
            <div id="stat-speakers" class="location-stat-value">-</div>
            <div class="location-stat-label">Speakers</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Upcoming Events -->
    <section class="location-events">
      <div class="section-header">
        <h2>Upcoming Events</h2>
        <p>Don't miss out on what's happening next</p>
      </div>
      <div id="upcoming-events" class="events-grid">
        <div class="loading-spinner"><div class="spinner"></div></div>
      </div>
    </section>

    <!-- Past Events -->
    <section id="past-section" class="location-events" style="background: var(--surface); display: none;">
      <div class="section-header">
        <h2>Past Events</h2>
        <p>A look back at what we've done together</p>
      </div>
      <div id="past-events" class="events-grid"></div>
      <div style="text-align: center; margin-top: var(--space-6);">
        <a href="/past" class="btn btn-secondary">View All Past Events</a>
      </div>
    </section>

    <!-- About Location -->
    <section class="location-about">
      <div class="about-content">
        <h2 id="about-title">About COLLECTIVE. in <span class="location-name"></span></h2>
        <p id="about-text"></p>
      </div>
    </section>

    <!-- Other Locations -->
    <section class="other-locations">
      <div class="section-header">
        <h2>Explore Other Locations</h2>
        <p>COLLECTIVE. is growing across the East Midlands</p>
      </div>
      <div id="other-locations" class="locations-grid"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-brand">
        <img src="https://storage.googleapis.com/msgsndr/JcB0t2fZpGS0lMrqKDWQ/media/696bc2db5e05d4243b73f7d5.png" alt="COLLECTIVE." class="footer-logo">
        <p>Building connections across the East Midlands creative, digital and tech community.</p>
      </div>
      <div class="footer-links">
        <h4>Events</h4>
        <ul>
          <li><a href="/">Upcoming</a></li>
          <li><a href="/past">Past Events</a></li>
          <li><a href="/speakers">Speakers</a></li>
        </ul>
      </div>
      <div class="footer-links">
        <h4>Locations</h4>
        <ul>
          <li><a href="/nottingham">Nottingham</a></li>
          <li><a href="/mansfield">Mansfield</a></li>
          <li><a href="/chesterfield">Chesterfield</a></li>
          <li><a href="/derby">Derby</a></li>
        </ul>
      </div>
      <div class="footer-links">
        <h4>Connect</h4>
        <ul>
          <li><a href="/about">About Us</a></li>
          <li><a href="mailto:hello@cdicollective.co.uk">Contact</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <div>
        <span style="color: var(--text-muted);">Proudly built in Notts by <a href="https://notluck.co.uk" target="_blank">NotLuck</a></span>
        <span style="margin-left: 1rem;">&copy; 2026 COLLECTIVE.</span>
      </div>
      <div class="social-links">
        <a href="https://linkedin.com/company/cdicollective" target="_blank" aria-label="LinkedIn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
        </a>
        <a href="https://instagram.com/cdicollective" target="_blank" aria-label="Instagram">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
        </a>
      </div>
    </div>
  </footer>

  <script src="/assets/js/api.js?v=2"></script>
  <script>
    const { fetchEvents, getEventImage, formatDate, getLocationColor, isUpcoming, LOCATION_IMAGES } = window.CollectiveAPI;

    // Location data
    const LOCATIONS = {
      nottingham: {
        name: 'Nottingham',
        description: 'Join COLLECTIVE. in Nottingham for inspiring events, workshops and networking in the heart of the creative quarter.',
        about: 'Nottingham is the beating heart of the East Midlands creative scene. Our events here bring together digital innovators, tech entrepreneurs, and creative professionals in some of the city\'s most inspiring venues. From intimate workshops to larger networking events, COLLECTIVE. Nottingham is where ideas come to life.',
        image: LOCATION_IMAGES.nottingham,
        color: 'lime'
      },
      mansfield: {
        name: 'Mansfield',
        description: 'Join COLLECTIVE. in Mansfield for inspiring events connecting North Nottinghamshire\'s creative community.',
        about: 'Mansfield is emerging as a vibrant hub for digital and creative talent. Our events here focus on building connections between local businesses, freelancers, and aspiring entrepreneurs. COLLECTIVE. Mansfield is committed to nurturing the region\'s growing tech ecosystem.',
        image: LOCATION_IMAGES.mansfield,
        color: 'lilac'
      },
      chesterfield: {
        name: 'Chesterfield',
        description: 'Join COLLECTIVE. in Chesterfield for inspiring events connecting Derbyshire\'s digital and creative professionals.',
        about: 'Chesterfield bridges the gap between the East Midlands and South Yorkshire creative communities. Our events here create opportunities for cross-regional collaboration, bringing fresh perspectives and new connections to Derbyshire\'s growing digital sector.',
        image: LOCATION_IMAGES.chesterfield,
        color: 'grey'
      },
      derby: {
        name: 'Derby',
        description: 'Join COLLECTIVE. in Derby for inspiring events connecting the city\'s thriving creative and tech community.',
        about: 'Derby has a proud heritage of innovation and creativity. Our events here bring together the city\'s digital pioneers, creative agencies, and tech startups. COLLECTIVE. Derby is expanding our reach to connect even more of the East Midlands creative community.',
        image: LOCATION_IMAGES.derby || LOCATION_IMAGES.nottingham,
        color: 'lime'
      }
    };

    let currentLocation = null;

    function getLocationFromPath() {
      const path = window.location.pathname.toLowerCase().replace(/^\/|\/$/g, '');
      return LOCATIONS[path] ? path : null;
    }

    async function init() {
      const locationKey = getLocationFromPath();

      if (!locationKey) {
        window.location.href = '/';
        return;
      }

      currentLocation = LOCATIONS[locationKey];

      // Set active nav link
      document.querySelectorAll('.nav-link[data-location]').forEach(link => {
        if (link.dataset.location === locationKey) {
          link.classList.add('active');
        }
      });

      // Render hero
      renderHero(locationKey);

      // Load events
      await loadEvents(locationKey);

      // Render other locations
      renderOtherLocations(locationKey);
    }

    function renderHero(locationKey) {
      const loc = LOCATIONS[locationKey];

      document.getElementById('hero-image').src = loc.image;
      document.getElementById('hero-image').alt = loc.name;
      document.getElementById('hero-badge').className = `badge badge-${loc.color}`;
      document.getElementById('location-title').textContent = loc.name;
      document.getElementById('location-description').textContent = loc.description;

      // About section
      document.querySelector('.location-name').textContent = loc.name;
      document.getElementById('about-text').textContent = loc.about;

      // Update page title
      document.title = `COLLECTIVE. ${loc.name} | Creative & Tech Events`;
    }

    async function loadEvents(locationKey) {
      // Fetch all events and filter by location (case-insensitive)
      const data = await fetchEvents({ limit: 200 });
      const allEvents = data.events || [];
      const events = allEvents.filter(e =>
        e.locationTag?.toLowerCase() === locationKey.toLowerCase()
      );

      const upcoming = events.filter(e => isUpcoming(e.date));
      const past = events.filter(e => !isUpcoming(e.date)).slice(0, 6);

      // Update stats
      document.getElementById('stat-events').textContent = events.length;
      document.getElementById('stat-upcoming').textContent = upcoming.length;

      // Count unique speakers
      const speakers = new Set();
      events.forEach(e => {
        // Handle both e.speaker (object) and e.speakers (array) formats
        if (e.speaker) {
          speakers.add(e.speaker.id || e.speaker.name);
        }
        if (e.speakers && Array.isArray(e.speakers)) {
          e.speakers.forEach(s => speakers.add(s.id || s.name));
        }
      });
      document.getElementById('stat-speakers').textContent = speakers.size;

      // Render upcoming events
      renderEvents('upcoming-events', upcoming, true);

      // Render past events
      if (past.length > 0) {
        document.getElementById('past-section').style.display = 'block';
        renderEvents('past-events', past, false);
      }
    }

    function renderEvents(containerId, events, isUpcomingSection) {
      const container = document.getElementById(containerId);

      if (events.length === 0) {
        container.innerHTML = `
          <div class="empty-state" style="grid-column: 1 / -1;">
            <h3>${isUpcomingSection ? 'No upcoming events' : 'No past events'}</h3>
            <p>${isUpcomingSection ? 'Check back soon for new events in this area!' : ''}</p>
          </div>
        `;
        return;
      }

      container.innerHTML = events.map(event => `
        <a href="/event/${event.slug || event.id}" class="card card-hover">
          <div class="card-image">
            <img src="${getEventImage(event)}" alt="${event.title}" loading="lazy">
            ${isUpcomingSection ? `
              <span class="badge badge-lime" style="position: absolute; top: 12px; left: 12px;">
                Upcoming
              </span>
            ` : ''}
          </div>
          <div class="card-content">
            <div class="card-meta">${formatDate(event.date)}</div>
            <h3 class="card-title">${event.title}</h3>
            <p class="card-description">${event.shortDescription || ''}</p>
          </div>
        </a>
      `).join('');
    }

    function renderOtherLocations(currentKey) {
      const container = document.getElementById('other-locations');
      const otherKeys = Object.keys(LOCATIONS).filter(k => k !== currentKey);

      container.innerHTML = otherKeys.map(key => {
        const loc = LOCATIONS[key];
        return `
          <a href="/${key}" class="location-card">
            <img src="${loc.image}" alt="${loc.name}" loading="lazy">
            <div class="location-card-overlay">
              <h3>${loc.name}</h3>
            </div>
          </a>
        `;
      }).join('');
    }

    // Initialize
    init();
  </script>
</body>
</html>
